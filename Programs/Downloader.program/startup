SpeedOS.LoadAPI("SpeedAPI/windows")
SpeedOS.LoadAPI("SpeedAPI/config")

pathToConfig = "System/Downloader.settings"

use_http = false

if config.read(pathToConfig, "enable http") == "true" then
  use_http = true

else
  use_http = false
end

fs = SpeedOS.fs

function downloadFile(l, p)
  if use_http then
    if not string.find(l, "http://") then 
      l = "http://"..l
    end
    
  else
    if not string.find(l, "https://") then 
      l = "https://"..l
    end
  end

  data = http.get(l)

  if not data then
    windows.clearScreen(colors.cyan)
    windows.error("Can't connect to URL!")
    Menu()
  end
  
  f = fs.open("" ..tostring(p), "w")
  f.write(data.readAll())
  f.close()
end

function Menu()
  windows.clearScreen(colors.cyan)
  local vvedeno = windows.input("auto","auto","Download",20,{"Link",""},{"Save as",""})

  downloadFile(vvedeno[1], vvedeno[2])
  windows.clearScreen(colors.cyan)
  windows.attention({"Sucessfuly downloaded!"}, {"File was saved as", vvedeno[2].."!"})
end

while true do
  Menu()
end
